<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>A Random Commander</title>
</head>

<body>
  <div id="cardContain">
    <h3 id="cardTotal">Selected from ???? possible commanders...</h3>
    <h1 id="cardName">Card Name</h1>
    <ul>
      <li><a href="#" id="cardScryfall">Scryfall</a></li>
      <li><a href="#" id="cardEDHREC">EDHREC</a></li>
      <li><a href="#" id="cardTCGPlayer">TCG Player</a></li>
    </ul>
    <p>
      <img src="filler.png" alt="Filler Card" id="cardImg">
    </p>
  </div>

  <script type="text/javascript">
    console.log("Hello, fox. It's been a while.");
    var aryCommanders;
    getAllCards();

    /**************************
    == Functions start here! ==
    **************************/

    function getRandCard(inScry) {
      var intRandom = Math.floor(Math.random() * inScry.data.length);
      console.log("Randomly selected index is " + intRandom);
      fillCard(inScry.data[intRandom]);
    }
    // End of getRandCard function

    function fillCard(inCard)
    {
      document.getElementById("cardName").innerHTML = inCard.name;
      document.getElementById("cardImg").src = inCard.image_uris.normal;
      document.getElementById("cardScryfall").href = inCard.scryfall_uri;
      document.getElementById("cardEDHREC").href = inCard.related_uris.edhrec;
      document.getElementById("cardTCGPlayer").href = inCard.purchase_uris.tcgplayer;
    }
    // End of fillCard function

    function getAPIcall()
    {
      return "https://api.scryfall.com/cards/search?q=is%3Acommander";
    }

    function getAllCards() {
      var urlScryfall = getAPIcall();
      console.log("Current API call: " + urlScryfall);

      var xmlHttp = new XMLHttpRequest();
      xmlHttp.onreadystatechange = function() {
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
          aryCommanders = JSON.parse(this.responseText);
          console.log("Selected from " + aryCommanders.total_cards + " possible Commanders...");
          document.getElementById("cardTotal").innerHTML = "Selected from " + aryCommanders.total_cards + " possible Commanders...";

          getRandCard(aryCommanders);
        } else {
          console.log("Failed to call!");
        }
      };
      // End of onreadystatchange function re-write

      xmlHttp.open("GET", urlScryfall, true); // true for asynchronous
      xmlHttp.send(null);
    }
    // End of GetAllCards function
  </script>

</body>

</html>
